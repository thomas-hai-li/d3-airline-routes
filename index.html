<!-- Coursera NYU - Information Visualization: Programming with D3.js -->
<!DOCTYPE html>
<html class="gr__d3c33hcgiwev3_cloudfront_net">
<head>
    <title>Visualize Airline Routes</title>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="Content-Type" content="text/html; charset=windows-1252">

    <style>
        body {
            font-family: Helvetica, Arial, sans-serif
        }

        h1 {
            background-color: #2a5599;
            color: white;
            padding: 5px;
        }

        svg {
            border: 1px solid black;
        }

        .mainView {
            display: flex;
        }
    </style>

    <script src="d3.js"></script>
</head>

<body data-gr-c-s-loaded="true">
    <h1>Airlines Routes</h1>
    <div class="mainView">
        <div>
            <h2>Airlines</h2>
            <svg id="AirlinesChart"></svg>
        </div>
        <div>
            <h2>Airports</h2>
            <svg id="Map"></svg>
        </div>
    </div>
</body>

<script>
    let store = {};

    function loadData() {
        let promise = d3.csv("routes.csv");
        return promise.then(routes => {
            store.routes = routes;
        return store;
        });
    }

    function showData() {
        let routes = store.routes;
        // Compute the number of routes per airline.
        let airlines = groupByAirline(routes);
        console.log(airlines);
    }

    function groupByAirline(data) {
        //Iterate over each route, producing a dictionary where the keys are the airlines IDs and the values are the properties of the airline
        let result = data.reduce((result, d) => {
            let currentData = result[d.AirlineID] || {
                "AirlineID": d.AirlineID,
                "AirlineName": d.AirlineName,
                "Count": 0
            }

            currentData.Count += 1;
            result[d.AirlineID] = currentData;

            return result;
        }, {});

        //Convert result into a list
        result = Object.keys(result).map(key => result[key])
        result.sort(function (d1, d2) {
            return d3.descending(d1.Count, d2.Count);            
        });

        return result;
    }

    loadData().then(showData);
</script>
</html>
